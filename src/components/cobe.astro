---
const globeMaxSize = 1000;
---

<canvas
    id="cobe"
    width={globeMaxSize}
    height={globeMaxSize}
    class="dark:opacity-50"></canvas>

<script define:vars={{ globeMaxSize }} type="module">
    import createGlobe from "https://cdn.skypack.dev/cobe";

    let canvas = document.getElementById("cobe");
    let globeSize = computeGlobeSize(globeMaxSize);

    canvas.width = globeSize;
    canvas.height = globeSize;

    let phi = 0;
    let globeInstance = null;

    function computeGlobeSize(globeMaxSize) {
        let size = globeMaxSize;
        const { innerWidth: width } = window;
        if (width < globeMaxSize) {
            size = Math.max(width * 0.6, 200);
        }
        return size;
    }

    function addGlobe(canvas) {
        const globe = createGlobe(canvas, {
            width: canvas.width,
            height: canvas.height,
            phi: 0,
            theta: 0,
            dark: 0,
            diffuse: 1.2,
            scale: 1,
            mapSamples: 16000,
            mapBrightness: 5,
            baseColor: [1, 1, 1],
            markerColor: [1, 0.5, 1],
            glowColor: [1, 1, 1],
            offset: [0, 0],
            opacity: 0.9,
            markers: [
                { location: [39, -84], size: 0.05 },
                { location: [39, -85], size: 0.05 },
                { location: [40, -84], size: 0.05 },
                { location: [45, -118], size: 0.05 },
                { location: [-22.5, 144], size: 0.05 },
                { location: [-31.2, 147], size: 0.05 },
                { location: [-36.9, 143], size: 0.05 },
                { location: [-34.7, 138.6], size: 0.05 },
                { location: [-22.2, 114.9], size: 0.05 },
                { location: [-35.3, 149], size: 0.05 },
                { location: [-13, 130.8], size: 0.05 },
                { location: [-16, 123], size: 0.05 },
                { location: [34.9, -76.9], size: 0.05 },
                { location: [35.6, -117.6], size: 0.05 },
                { location: [30.3, -81.6], size: 0.05 },
                { location: [40, -74.3], size: 0.05 },
                { location: [28.5, -81.3], size: 0.05 },
                { location: [38.3, -76.4], size: 0.05 },
                { location: [34, -117], size: 0.05 },
                { location: [32.7, -117], size: 0.05 },
                { location: [48.8, -2.3], size: 0.05 },
                { location: [32.3, -86.9], size: 0.05 },
            ],
            onRender: (state) => {
                // Called on every animation frame.
                // `state` will be an empty object, return updated params.
                state.phi = phi;
                phi += 0.01;
            },
        });

        return globe;
    }

    function resizeGlobe() {
        globeSize = computeGlobeSize(globeMaxSize);
        canvas.width = globeSize;
        canvas.height = globeSize;
        if (globeInstance && globeInstance.destroy) {
            globeInstance.destroy();
        }
        globeInstance = addGlobe(canvas);
    }

    globeInstance = addGlobe(canvas);

    // Update the globe dimensions when the window is resized
    window.addEventListener("resize", () => {
        resizeGlobe();
    });
</script>
